"use strict";(self["webpackChunkfilefront"]=self["webpackChunkfilefront"]||[]).push([[24],{5188:function(e,l,o){o.d(l,{Z:function(){return f}});var a=o(6252),t=o(3577);const i={class:"table-container"},n={class:"search-wrap"},r={class:"table-wrap"},u={key:0,class:"pagination-wrap"};function s(e,l,o,s,c,p){const d=(0,a.up)("el-table-column"),m=(0,a.up)("el-tag"),f=(0,a.up)("el-button"),g=(0,a.up)("el-switch"),w=(0,a.up)("el-progress"),h=(0,a.up)("el-image"),b=(0,a.up)("el-table"),y=(0,a.up)("el-pagination"),C=(0,a.Q2)("loading");return(0,a.wg)(),(0,a.iD)("div",i,[(0,a._)("div",n,[(0,a.WI)(e.$slots,"search")]),(0,a._)("div",r,[(0,a.wy)(((0,a.wg)(),(0,a.j4)(b,{data:o.data,border:"",stripe:"",size:"mini","row-key":"id","tree-props":{children:"children",hasChildren:"hasChildren"},"header-cell-style":o.headerCellStyle,"cell-style":e.cellStyle,onSelectionChange:e.onSelectionChange,style:{width:"100%"}},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(o.column,(l=>((0,a.wg)(),(0,a.iD)(a.HY,{key:l},[l.prop||l.label?"tag"==l.type?((0,a.wg)(),(0,a.j4)(d,{key:1,"show-overflow-tooltip":"",label:l.label,align:null!=l.align?l.align:"center",width:l.width},{default:(0,a.w5)((e=>[(0,a.Wm)(m,{size:l.option.size,effect:l.option.effect,type:l.option.type},{default:(0,a.w5)((()=>[(0,a.Uk)((0,t.zw)(e.row[l.prop]),1)])),_:2},1032,["size","effect","type"])])),_:2},1032,["label","align","width"])):"button"==l.type?((0,a.wg)(),(0,a.j4)(d,{key:2,"show-overflow-tooltip":"",label:l.label,align:null!=l.align?l.align:"center",width:l.width},{default:(0,a.w5)((o=>[(0,a.Wm)(f,{onClick:l=>e.$emit("onButtonClick",o.row),type:"text",size:l.option.size},{default:(0,a.w5)((()=>[(0,a.Uk)((0,t.zw)(o.row[l.prop]),1)])),_:2},1032,["onClick","size"])])),_:2},1032,["label","align","width"])):"switch"==l.type?((0,a.wg)(),(0,a.j4)(d,{key:3,"show-overflow-tooltip":"",label:l.label,align:null!=l.align?l.align:"center",width:l.width},{default:(0,a.w5)((o=>[(0,a.Wm)(g,{onChange:l=>e.$emit("onSwitchChange",o.row),"inline-prompt":"","active-value":l.option.activeValue,"active-color":l.option.activeColor,"active-text":l.option.activeText,"inactive-value":l.option.inactiveValue,"inactive-color":l.option.inactiveColor,"inactive-text":l.option.inactiveText,modelValue:o.row[l.prop],"onUpdate:modelValue":e=>o.row[l.prop]=e},null,8,["onChange","active-value","active-color","active-text","inactive-value","inactive-color","inactive-text","modelValue","onUpdate:modelValue"])])),_:2},1032,["label","align","width"])):"progress"==l.type?((0,a.wg)(),(0,a.j4)(d,{key:4,"show-overflow-tooltip":"",label:l.label,align:null!=l.align?l.align:"center",width:l.width},{default:(0,a.w5)((e=>[(0,a.Wm)(w,{percentage:e.row[l.prop],status:l.option.status,color:l.option.color},null,8,["percentage","status","color"])])),_:2},1032,["label","align","width"])):"img"==l.type?((0,a.wg)(),(0,a.j4)(d,{key:5,"show-overflow-tooltip":"",label:l.label,align:null!=l.align?l.align:"center",width:l.width},{default:(0,a.w5)((o=>[(0,a.Wm)(h,{style:{width:"50px",height:"50px"},src:e.imageUrlPrefix+o.row[l.prop],class:"head_pic"},null,8,["src"])])),_:2},1032,["label","align","width"])):((0,a.wg)(),(0,a.j4)(d,{key:6,"show-overflow-tooltip":"",prop:null==l.alias?l.prop:l.alias,label:l.label,align:null!=l.align?l.align:"center",width:l.width,fixed:l.fixed},null,8,["prop","label","align","width","fixed"])):((0,a.wg)(),(0,a.j4)(d,{key:0,fixed:l.fixed,type:"selection",width:"45"},null,8,["fixed"]))],64)))),128)),o.operation?((0,a.wg)(),(0,a.j4)(d,{key:0,fixed:"right",label:"操作",align:"center",width:"220"},{default:(0,a.w5)((l=>[(0,a.WI)(e.$slots,"column",{column:l})])),_:3})):(0,a.kq)("",!0)])),_:3},8,["data","header-cell-style","cell-style","onSelectionChange"])),[[C,o.loading]])]),o.page?((0,a.wg)(),(0,a.iD)("div",u,[(0,a.Wm)(y,{onSizeChange:e.onSizeChange,onCurrentChange:e.onCurrentChange,layout:"total, sizes, prev, pager, next, jumper","current-page":o.page.current,"page-sizes":[10,20,50,100],"page-size":o.page.size,total:o.page.total},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])])):(0,a.kq)("",!0)])}var c=o(2262),p={props:{loading:{type:Boolean,default:!1},page:{type:Object,default:{current:1,size:10,total:0}},column:{type:Array,default:[]},operation:{type:Boolean,default:!1},headerCellStyle:{type:Object,default:{color:"#606266",fontWeight:700,background:"var(--bg1)"}},data:{type:Array,default:[]}},emits:["onSizeChange","onCurrentChange","onSelectionChange","setCellColor","onButtonClick","onSwitchChange"],setup(e,l){const o=(0,c.qj)({cellStyle:function(e){let o={};return l.emit("setCellColor",e,((e={})=>{o=e})),o.padding="2px",o},imageUrlPrefix:(0,a.FN)()?.appContext.config.globalProperties.$imageUrl,onSizeChange:e=>{l.emit("onSizeChange",e)},onCurrentChange:e=>{l.emit("onCurrentChange",e)}});return{...(0,c.BK)(o)}}},d=o(3744);const m=(0,d.Z)(p,[["render",s]]);var f=m},1024:function(e,l,o){o.r(l),o.d(l,{default:function(){return h}});var a=o(6252);const t={class:"file"},i=(0,a._)("div",{class:"el-upload__tip"}," jpg/png files with a size less than 500KB. ",-1),n={class:"dialog-footer"};function r(e,l,o,r,u,s){const c=(0,a.up)("el-button"),p=(0,a.up)("el-col"),d=(0,a.up)("el-input"),m=(0,a.up)("el-form-item"),f=(0,a.up)("el-row"),g=(0,a.up)("Table"),w=(0,a.up)("el-option"),h=(0,a.up)("el-select"),b=(0,a.up)("el-cascader"),y=(0,a.up)("el-upload"),C=(0,a.up)("el-form"),v=(0,a.up)("el-dialog"),F=(0,a.up)("el-card");return(0,a.wg)(),(0,a.iD)("div",t,[(0,a.Wm)(F,null,{default:(0,a.w5)((()=>[(0,a.Wm)(g,{data:e.tableData,column:e.tableTitle,operation:!0,page:e.page,loading:e.loading,onOnSizeChange:e.onSizeChange,onOnCurrentChange:e.onCurrentChange,onSetCellColor:e.setCellColor},{search:(0,a.w5)((()=>[(0,a.Wm)(f,{gutter:24},{default:(0,a.w5)((()=>[(0,a.Wm)(p,{span:3},{default:(0,a.w5)((()=>[(0,a.Wm)(c,{type:"primary",onClick:e.onAddFile},{default:(0,a.w5)((()=>[(0,a.Uk)("添加新闻")])),_:1},8,["onClick"])])),_:1}),(0,a.Wm)(p,{span:7},{default:(0,a.w5)((()=>[(0,a.Wm)(m,{label:"新闻名"},{default:(0,a.w5)((()=>[(0,a.Wm)(d,{modelValue:e.searchForm.oldName,"onUpdate:modelValue":l[0]||(l[0]=l=>e.searchForm.oldName=l),placeholder:"请输入新闻名称"},null,8,["modelValue"])])),_:1})])),_:1}),(0,a.Wm)(p,{span:7,label:"新闻上传人"},{default:(0,a.w5)((()=>[(0,a.Wm)(m,{label:"新闻上传人"},{default:(0,a.w5)((()=>[(0,a.Wm)(d,{modelValue:e.searchForm.creator,"onUpdate:modelValue":l[1]||(l[1]=l=>e.searchForm.creator=l),placeholder:"请输入新闻上传人"},null,8,["modelValue"])])),_:1})])),_:1}),(0,a.Wm)(p,{span:6},{default:(0,a.w5)((()=>[(0,a.Wm)(c,{onClick:e.onRefresh,icon:"RefreshRight",circle:""},null,8,["onClick"]),(0,a.Wm)(c,{onClick:e.onSearch,type:"primary",icon:"Search"},{default:(0,a.w5)((()=>[(0,a.Uk)("查询")])),_:1},8,["onClick"])])),_:1})])),_:1})])),column:(0,a.w5)((l=>[(0,a.Wm)(c,{onClick:o=>e.download(l),type:"text",style:{color:"var(--edit)"}},{default:(0,a.w5)((()=>[(0,a.Uk)("下载")])),_:2},1032,["onClick"]),(0,a.Wm)(c,{onClick:o=>e.onPreview(l),type:"text",style:{color:"var(--delete)"}},{default:(0,a.w5)((()=>[(0,a.Uk)("预览")])),_:2},1032,["onClick"]),(0,a.Wm)(c,{onClick:o=>e.onEdit(l),type:"text",style:{color:"var(--edit)"}},{default:(0,a.w5)((()=>[(0,a.Uk)("编辑")])),_:2},1032,["onClick"]),(0,a.Wm)(c,{onClick:o=>e.onDelete(l),type:"text",style:{color:"var(--delete)"}},{default:(0,a.w5)((()=>[(0,a.Uk)("删除")])),_:2},1032,["onClick"])])),_:1},8,["data","column","page","loading","onOnSizeChange","onOnCurrentChange","onSetCellColor"]),(0,a.Wm)(v,{title:e.fileTitle,modelValue:e.fileVisible,"onUpdate:modelValue":l[8]||(l[8]=l=>e.fileVisible=l),"show-close":!1},{footer:(0,a.w5)((()=>[(0,a._)("span",n,[(0,a.Wm)(c,{onClick:l[7]||(l[7]=l=>e.fileVisible=!1)},{default:(0,a.w5)((()=>[(0,a.Uk)("取消")])),_:1}),(0,a.Wm)(c,{type:"primary",onClick:e.onSubmit},{default:(0,a.w5)((()=>[(0,a.Uk)("提交")])),_:1},8,["onClick"])])])),default:(0,a.w5)((()=>[(0,a.Wm)(C,{model:e.fileForm,rules:e.rules,ref:"fileRuleForm","status-icon":"","label-width":"100px"},{default:(0,a.w5)((()=>[(0,a.Wm)(m,{prop:"cno",label:"新闻总部名",rules:[{required:!0,message:"请选择新闻总部",trigger:"blur"}]},{default:(0,a.w5)((()=>[(0,a.Wm)(h,{modelValue:e.fileForm.cno,"onUpdate:modelValue":l[2]||(l[2]=l=>e.fileForm.cno=l),placeholder:"请选择新闻总部",onChange:l[3]||(l[3]=l=>e.getBranchDivision(e.fileForm.cno)),style:{width:"100%"}},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.newsData,(e=>((0,a.wg)(),(0,a.j4)(w,{label:e.cname+"---"+e.tname,value:e.cno},null,8,["label","value"])))),256))])),_:1},8,["modelValue"])])),_:1}),(0,a.Wm)(m,{prop:"branch",label:"分部分部",rules:[{required:!0,message:"请输入分部",trigger:"blur"}]},{default:(0,a.w5)((()=>[(0,a.Wm)(b,{options:e.options,modelValue:e.fileForm.branchDivision,"onUpdate:modelValue":l[4]||(l[4]=l=>e.fileForm.branchDivision=l),clearable:""},null,8,["options","modelValue"])])),_:1}),(0,a.Wm)(m,{prop:"type",label:"类型",rules:[{required:!0,message:"请选择类型",trigger:"blur"}]},{default:(0,a.w5)((()=>[(0,a.Wm)(h,{modelValue:e.fileForm.type,"onUpdate:modelValue":l[5]||(l[5]=l=>e.fileForm.type=l),placeholder:"请选择类型",style:{width:"100%"}},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.typeData,(e=>((0,a.wg)(),(0,a.j4)(w,{label:e.cname,value:e.typeId},null,8,["label","value"])))),256))])),_:1},8,["modelValue"])])),_:1}),(0,a.Wm)(m,{label:"新闻",rules:[{required:!0,message:"请上传新闻",trigger:"blur"}]},{default:(0,a.w5)((()=>[(0,a.Wm)(y,{"file-list":e.fileList,"onUpdate:fileList":l[6]||(l[6]=l=>e.fileList=l),class:"upload-demo","on-preview":e.handlePreview,"on-remove":e.handleRemove,limit:1,httpRequest:e.uploadFile,"auto-upload":"false"},{tip:(0,a.w5)((()=>[i])),default:(0,a.w5)((()=>[(0,a.Wm)(c,{type:"primary"},{default:(0,a.w5)((()=>[(0,a.Uk)("Click to upload")])),_:1})])),_:1},8,["file-list","on-preview","on-remove","httpRequest"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["title","modelValue"])])),_:1})])}o(7658);var u=o(2262),s=o(1348),c=o(9737),p=o(5188),d=o(9669),m=o.n(d),f={props:{},components:{Table:p.Z},setup(){(0,a.bv)((()=>{e.onSearchNews(),e.onFilePage(),e.onFileType()}));const e=(0,u.qj)({searchForm:{oldName:null,creator:null},newsData:[],fileList:[],typeData:[],userName:"张三",loading:!1,page:{current:1,size:10,total:1},tableTitle:[{prop:"",label:"",fixed:"left"},{prop:"typeName",label:"用户发布上传类型"},{prop:"newsName",label:"新闻总部名称"},{prop:"oldName",label:"新闻"},{prop:"creator",label:"上传者"},{prop:"downloadNum",label:"下载次数"}],options:[],tableData:[],fileRuleForm:(0,u.iH)(null),fileVisible:!1,fileTitle:"添加新闻",operate:0,fileForm:{id:"",cno:"",resourceType:"",newName:"",oldName:"",url:"",size:"",suffix:"",creator:"",type:"",enabled:0,downloadNum:0,uploadTime:"",branch:"",division:!0,branchDivision:[]},orgData:[],getBranchDivision:async l=>{e.loading=!0,l&&(e.searchForm.options="",await m().get("/division/getBranchDivision",{params:{cno:l}}).then((l=>{e.loading=!1,e.options=l.data.result})))},uploadRef:(0,u.iH)(null),imageUrlPrefix:(0,a.FN)()?.appContext.config.globalProperties.$imageUrl,onFilePage:()=>{e.loading=!0,m().get("/fileInfo/getFileInfoList",{params:Object.assign(e.page,e.searchForm)}).then((l=>{e.loading=!1,e.tableData=l.data.result.list,e.page.current=l.data.result.pageNum,e.page.size=l.data.result.pageSize,e.page.total=l.data.result.total}))},onSearch:()=>{e.onFilePage()},onFileType:()=>{e.loading=!0,m().get("/fileType/getAllFileType").then((l=>{e.loading=!1,e.typeData=l.data.result}))},onRefresh:()=>{e.searchForm={cname:null},e.onFilePage()},onSizeChange:l=>{e.page.size=l,e.onFilePage()},onCurrentChange:l=>{e.page.current=l,e.onFilePage()},onPreview:l=>{window.open(e.imageUrlPrefix+l.column.row.url)},download:e=>{const l={method:"get",url:"download",params:{url:e.column.row.url},headers:{"Content-Type":"application/octet-stream;charset=UTF-8"},responseType:"blob"};m()(l).then((l=>{const o=window.URL.createObjectURL(new Blob([l.data])),a=document.createElement("a");a.href=o,a.setAttribute("download",e.column.row.oldName),document.body.appendChild(a),a.click()}))},onSearchNews:()=>{m().get("/news/getAllNews").then((l=>{e.newsData=l.data.result}))},onAddFile:()=>{e.fileTitle="添加新闻",e.operate=0,e.fileForm={id:"",cno:"",resourceType:"",newName:"",oldName:"",url:"",size:"",suffix:"",creator:"",type:"0",enabled:!0,downloadNum:0,uploadTime:"",branch:"",division:"",branchDivision:[]},e.fileVisible=!0},onEdit:l=>{e.fileTitle="修改新闻",e.operate=1,e.getBranchDivision(l.column.row.cno),e.fileForm={id:l.column.row.id,cno:l.column.row.cno,resourceType:l.column.row.resourceType,newName:l.column.row.newName,oldName:l.column.row.oldName,url:l.column.row.url,size:l.column.row.size,suffix:l.column.row.suffix,type:l.column.row.type,creator:l.column.row.creator,enabled:l.column.row.enabled,downloadNum:l.column.row.downloadNum,uploadTime:l.column.row.uploadTime,branch:l.column.row.branch,division:l.column.row.division},e.fileForm.branchDivision=[e.fileForm.branch,e.fileForm.division],e.fileList=[],e.fileList.push({name:l.column.row.oldName,url:e.imageUrl+e.fileForm.fileUrl}),e.fileVisible=!0},onSubmit:async()=>{e.fileForm.branch=e.fileForm.branchDivision[0],e.fileForm.division=e.fileForm.branchDivision[1];const l=e.fileRuleForm;l&&(await l.validate(),0==e.operate?m().post("/fileInfo/fileInfoSave",e.fileForm).then((l=>{l.data.result&&(s.z8.success({message:"添加成功！",type:"success"}),e.onFilePage(),e.fileList=[],e.fileVisible=!1)})):m().patch("/fileInfo/fileInfoUpdate",e.fileForm).then((l=>{l.data.result&&(s.z8.success({message:"修改成功！",type:"success"}),e.onFilePage(),e.fileList=[],e.fileVisible=!1)})))},onDelete:l=>{c.T.confirm("此操作将永久删除该新闻, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{let o={id:l.column.row.id};m()["delete"]("/fileInfo/fileInfoDelete",{params:o}).then((l=>{l.data.result&&(s.z8.success("删除成功!"),e.onFilePage())}))})).catch((e=>{console.log(e)}))},uploadFile:l=>{var o=l.file,a=new FormData;a.append("myfile",o),m().post("uploadFile",a).then((l=>{var o=l.data.result;e.fileForm.newName=o.newName,e.fileForm.oldName=o.oldName,e.fileForm.url=o.url,e.fileForm.size=o.size,e.fileForm.suffix=o.suffix,e.fileForm.resourceType=o.resourceType,e.fileForm.creator=e.userName,e.fileForm.downloadNum=0,s.z8.success({message:"上传成功",type:"success"})})).catch((e=>{console.log(e)}))}});return{...(0,u.BK)(e)}}},g=o(3744);const w=(0,g.Z)(f,[["render",r]]);var h=w}}]);
//# sourceMappingURL=24.16c4b1a1.js.map